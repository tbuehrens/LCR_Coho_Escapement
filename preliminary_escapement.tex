% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Preliminary Coho Escapement Estimate},
  pdfauthor={Thomas Buehrens (tbuehrens@dfw.wa.gov)},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Preliminary Coho Escapement Estimate}
\author{Thomas Buehrens
(\href{mailto:tbuehrens@dfw.wa.gov}{\nolinkurl{tbuehrens@dfw.wa.gov}})}
\date{}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Last Updated 01/26/2022.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{background}{%
\subsection{Background}\label{background}}

Preliminary estimates of coho salmon escapement for the Washington State
portion of the Lower Columbia ESU are needed in early Febuary for
run-reconstruction and forecasting purposes. This is challenging because
coho have not yet completed their spawning so data is not yet done being
collected, entered, QA/QC'd, or analyzed. As a result we developed a
regression model to predict final coho escapement using real-time
datasets collected at a series of indicator locations in the Lower
Columbia region. Assuming this regression model has high prediction
performance, this prediction is suitable for use as a preliminary
estimate of coho escapement (for both wild and total abundance). Code
and data for this preliminary escapement model as well as the final
escapement model for the Washington State portion of the lower Columbia
Coho ESU may be found in this
\href{https://github.com/tbuehrens/LCR_Coho_Escapement}{\textbf{repository}}.

Indicator locations used in the model include: 1) Bonneville Dam (total
counts) 2) Willamette Falls (total counts) 3) Clackamas (wild counts at
NF Dam) 4) Washougal Hatchery (Type N counts of hatchery coho)

\hypertarget{setup}{%
\subsection{Setup}\label{setup}}

In the following section of code we will lode some external libraries
necessary to make the code run. We will then specify the year of
escapement we'd like to estimate and we will load the data used in the
regression models. Links to these data sources are included in the code
of this repository.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#=========}
\CommentTok{\# Packages}
\CommentTok{\#=========}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(rstan)}
\FunctionTok{library}\NormalTok{(rstanarm)}
\FunctionTok{library}\NormalTok{(mgcv)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(brms)}
\FunctionTok{library}\NormalTok{(kableExtra)}
\FunctionTok{library}\NormalTok{(reshape2)}


\CommentTok{\#=====================}
\CommentTok{\#Specify Forecast Year}
\CommentTok{\#=====================}
\NormalTok{f\_year}\OtherTok{\textless{}{-}}\DecValTok{2021} \CommentTok{\#this is the year we want to predict prelim escapement for}

\CommentTok{\#===========================}
\CommentTok{\#Data update links and files}
\CommentTok{\#===========================}
\CommentTok{\# LCR Totals = sum of medians by year Coho\_TRT\_Adults.csv}
\CommentTok{\# LCR Wild = sum of medians by year Coho\_TRT\_UM\_Ad.csv}
\CommentTok{\# Bonneville Dam: http://www.cbr.washington.edu/dart/cs/php/rpt/adult\_annual.php?sc=1\&outputFormat=csv\&proj=BON\&startdate=1\%2F1\&enddate=12\%2F31\&run=}
\CommentTok{\# Willamette Dam: "http://www.cbr.washington.edu/dart/cs/php/rpt/adult\_annual.php?sc=1\&outputFormat=csv\&proj=WFF\&startdate=1\%2F1\&enddate=12\%2F31\&run="}
\CommentTok{\# Clackamas (early + late wild): https://portlandgeneral.com/about/fish{-}wildlife{-}habitats/fish{-}counts{-}fish{-}runs/clackamas{-}daily{-}fish{-}counts}
\CommentTok{\# cowlitz ...open 10 year table https://www.mytpu.org/community{-}environment/fish{-}wildlife{-}environment/cowlitz{-}fish{-}report/}
\CommentTok{\# washougal get the type N adult Hatchery total: https://wdfw.wa.gov/fishing/management/hatcheries/escapement\#weekly{-}reports}

\NormalTok{LCR.total}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"results/Results\_2021{-}10{-}01/2010\_2020\_Coho\_TRT\_Adults.csv"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Year)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{LCR.total =} \FunctionTok{sum}\NormalTok{(Median))}
\NormalTok{LCR.wild}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"results/Results\_2021{-}10{-}01/2010\_2020\_Coho\_TRT\_UM\_Ad.csv"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Year)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{LCR.wild =} \FunctionTok{sum}\NormalTok{(Median))}
\NormalTok{Bonneville.total}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"http://www.cbr.washington.edu/dart/cs/php/rpt/adult\_annual.php?sc=1\&outputFormat=csv\&proj=BON\&startdate=1\%2F1\&enddate=12\%2F31\&run="}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Year,}\AttributeTok{Bonneville.total=}\NormalTok{Coho)}
\NormalTok{Willamette.total}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"http://www.cbr.washington.edu/dart/cs/php/rpt/adult\_annual.php?sc=1\&outputFormat=csv\&proj=WFF\&startdate=1\%2F1\&enddate=12\%2F31\&run="}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Year,}\AttributeTok{Willamette.total=}\NormalTok{Coho)}

\NormalTok{dat}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"final data/cohocorr.csv"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(LCR.total)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(LCR.wild)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(Bonneville.total)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(Willamette.total)}

\FunctionTok{print}\NormalTok{(dat, }\AttributeTok{width=}\DecValTok{100}\NormalTok{, }\AttributeTok{n =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 8
##     Year Clackamas.w Cowlitz.barrier.total Washougal.hatchery.late.h LCR.total
##    <dbl>       <dbl>                 <dbl>                     <dbl>     <dbl>
##  1  2010        1338                 76876                      2555     61008
##  2  2011        1817                 37791                      1550     50675
##  3  2012        1316                 10538                      1307     31803
##  4  2013        2329                 16602                      2412     51626
##  5  2014        8232                 93072                     11208    139859
##  6  2015        1475                  5718                       816     21698
##  7  2016        1338                 24426                      2469     53477
##  8  2017        7078                 20279                      3304     50565
##  9  2018        2882                 10995                      2400     41037
## 10  2019        3765                 15589                      2202     56902
## 11  2020        7469                 39043                      5047     79847
## 12  2021       10194                 56960                      4237        NA
##    LCR.wild Bonneville.total Willamette.total
##       <dbl>            <dbl>            <dbl>
##  1    28095           120915            20103
##  2    28711           145299             3393
##  3    22375            54968             6571
##  4    28354            59610            18629
##  5    87807           279733            18070
##  6    11371            37402             2651
##  7    25842            42025             2559
##  8    28634            75936             3041
##  9    20012            40889             2557
## 10    32734            73961             7454
## 11    46383           121602            11800
## 12       NA           243603            21108
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat}\OtherTok{\textless{}{-}}\NormalTok{dat}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_at}\NormalTok{(}\AttributeTok{.vars=}\FunctionTok{c}\NormalTok{(}\StringTok{"Bonneville.total"}\NormalTok{,}\StringTok{"Willamette.total"}\NormalTok{, }\StringTok{"Clackamas.w"}\NormalTok{, }\StringTok{"Cowlitz.barrier.total"}\NormalTok{, }\StringTok{"Washougal.hatchery.late.h"}\NormalTok{),}\AttributeTok{.funs=}\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{c}\NormalTok{(}\FunctionTok{scale}\NormalTok{(}\FunctionTok{log}\NormalTok{(x))))}
\end{Highlighting}
\end{Shaded}

\hypertarget{fit-models-and-display-results}{%
\subsection{Fit Models And Display
Results}\label{fit-models-and-display-results}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(}\StringTok{"results/prelim/m1.RDS"}\NormalTok{))\{}
\NormalTok{  knots}\OtherTok{\textless{}{-}}\FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{Year))}\SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  m1}\OtherTok{\textless{}{-}}\FunctionTok{stan\_gamm4}\NormalTok{(}\FunctionTok{log}\NormalTok{(LCR.wild) }\SpecialCharTok{\textasciitilde{}} 
               \FunctionTok{s}\NormalTok{(Year,}\AttributeTok{bs=}\StringTok{"ps"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{               Bonneville.total }\SpecialCharTok{+} 
\NormalTok{               Willamette.total }\SpecialCharTok{+}
\NormalTok{               Clackamas.w }\SpecialCharTok{+}
\NormalTok{               Cowlitz.barrier.total }\SpecialCharTok{+}
\NormalTok{               Washougal.hatchery.late.h,}
             
               \CommentTok{\#prior=laplace(),}
               \AttributeTok{prior=}\FunctionTok{hs}\NormalTok{(}
\NormalTok{               ),}
             
             \AttributeTok{data=}\NormalTok{dat}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{\textless{}}\NormalTok{f\_year),}
             \AttributeTok{prior\_intercept =} \FunctionTok{cauchy}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{10}\NormalTok{),}
             \AttributeTok{chains=}\DecValTok{4}\NormalTok{,}
             \AttributeTok{cores=}\DecValTok{4}\NormalTok{,}
             \AttributeTok{iter=}\DecValTok{10000}\NormalTok{,}
             \AttributeTok{warmup=}\DecValTok{8000}\NormalTok{,}
             \AttributeTok{control=}\FunctionTok{list}\NormalTok{(}\AttributeTok{adapt\_delta=}\FloatTok{0.9995}\NormalTok{)}
\NormalTok{  )}
  \FunctionTok{saveRDS}\NormalTok{(m1,}\AttributeTok{file=}\StringTok{"results/prelim/m1.RDS"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    m1}\OtherTok{\textless{}{-}}\FunctionTok{readRDS}\NormalTok{(}\StringTok{"results/prelim/m1.RDS"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{preds}\OtherTok{\textless{}{-}}\FunctionTok{apply}\NormalTok{(}\FunctionTok{posterior\_predict}\NormalTok{(m1,}\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(dat}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"LCR.wild"}\NormalTok{,}\StringTok{"LCR.total"}\NormalTok{))),}\AttributeTok{draws=}\DecValTok{1000}\NormalTok{),}\DecValTok{2}\NormalTok{,}\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{quantile}\NormalTok{(x,}\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{,}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.75}\NormalTok{,}\FloatTok{0.975}\NormalTok{)))}
\NormalTok{results}\OtherTok{\textless{}{-}}\FunctionTok{data.frame}\NormalTok{(dat,}\FunctionTok{exp}\NormalTok{(}\FunctionTok{t}\NormalTok{(preds)))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Group=}\StringTok{"Wild Coho"}\NormalTok{)}

\NormalTok{p}\OtherTok{\textless{}{-}}\FunctionTok{ggplot}\NormalTok{(results,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{LCR.wild))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{,}\ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\NormalTok{X2.}\FloatTok{5.}\NormalTok{,}\AttributeTok{ymax=}\NormalTok{X97.}\FloatTok{5.}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\NormalTok{X25.,}\AttributeTok{ymax=}\NormalTok{X75.),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{X50.))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data=}\NormalTok{results}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{X50.),}\AttributeTok{color=}\StringTok{"forestgreen"}\NormalTok{,}\AttributeTok{size=}\DecValTok{3}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(}\StringTok{"results/prelim/m2.RDS"}\NormalTok{))\{}
\NormalTok{  knots}\OtherTok{\textless{}{-}}\FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{Year))}\SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  m2}\OtherTok{\textless{}{-}}\FunctionTok{stan\_gamm4}\NormalTok{(}\FunctionTok{log}\NormalTok{(LCR.total) }\SpecialCharTok{\textasciitilde{}} 
                   \FunctionTok{s}\NormalTok{(Year,}\AttributeTok{bs=}\StringTok{"ps"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{                   Bonneville.total }\SpecialCharTok{+} 
\NormalTok{                   Willamette.total }\SpecialCharTok{+}
\NormalTok{                   Clackamas.w }\SpecialCharTok{+}
\NormalTok{                   Cowlitz.barrier.total }\SpecialCharTok{+}
\NormalTok{                   Washougal.hatchery.late.h,}
                 
                 \CommentTok{\#prior=laplace(),}
                 \AttributeTok{prior=}\FunctionTok{hs}\NormalTok{(}
\NormalTok{                 ),}
                 
                 \AttributeTok{data=}\NormalTok{dat}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{\textless{}}\NormalTok{f\_year),}
                 \AttributeTok{prior\_intercept =} \FunctionTok{cauchy}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{10}\NormalTok{),}
                 \AttributeTok{chains=}\DecValTok{4}\NormalTok{,}
                 \AttributeTok{cores=}\DecValTok{4}\NormalTok{,}
                 \AttributeTok{iter=}\DecValTok{10000}\NormalTok{,}
                 \AttributeTok{warmup=}\DecValTok{8000}\NormalTok{,}
                 \AttributeTok{control=}\FunctionTok{list}\NormalTok{(}\AttributeTok{adapt\_delta=}\FloatTok{0.9995}\NormalTok{)}
\NormalTok{  )}
  \FunctionTok{saveRDS}\NormalTok{(m2,}\AttributeTok{file=}\StringTok{"results/prelim/m2.RDS"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    m2}\OtherTok{\textless{}{-}}\FunctionTok{readRDS}\NormalTok{(}\StringTok{"results/prelim/m2.RDS"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{preds2}\OtherTok{\textless{}{-}}\FunctionTok{apply}\NormalTok{(}\FunctionTok{posterior\_predict}\NormalTok{(m2,}\AttributeTok{newdata =} \FunctionTok{data.frame}\NormalTok{(dat}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"LCR.wild"}\NormalTok{,}\StringTok{"LCR.total"}\NormalTok{))),}\AttributeTok{draws=}\DecValTok{1000}\NormalTok{),}\DecValTok{2}\NormalTok{,}\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{quantile}\NormalTok{(x,}\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{,}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.75}\NormalTok{,}\FloatTok{0.975}\NormalTok{)))}
\NormalTok{results2}\OtherTok{\textless{}{-}}\FunctionTok{data.frame}\NormalTok{(dat,}\FunctionTok{exp}\NormalTok{(}\FunctionTok{t}\NormalTok{(preds2)))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Group=}\StringTok{"Total Coho"}\NormalTok{)}

\NormalTok{p2}\OtherTok{\textless{}{-}}\FunctionTok{ggplot}\NormalTok{(results2,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{LCR.total))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{,}\ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\NormalTok{X2.}\FloatTok{5.}\NormalTok{,}\AttributeTok{ymax=}\NormalTok{X97.}\FloatTok{5.}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\NormalTok{X25.,}\AttributeTok{ymax=}\NormalTok{X75.),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{X50.))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data=}\NormalTok{results2}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{X50.),}\AttributeTok{color=}\StringTok{"forestgreen"}\NormalTok{,}\AttributeTok{size=}\DecValTok{3}\NormalTok{)}
\NormalTok{p3}\OtherTok{\textless{}{-}}\FunctionTok{grid.arrange}\NormalTok{(p, p2, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{preliminary_escapement_files/figure-latex/fitmodels-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(p3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## TableGrob (1 x 2) "arrange": 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results3}\OtherTok{\textless{}{-}}\FunctionTok{bind\_rows}\NormalTok{(results,results2)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_tibble}\NormalTok{()}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Year, Group,}\AttributeTok{cols=}\FunctionTok{contains}\NormalTok{(}\StringTok{"x"}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{2.5\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols1"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{25\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols2"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{50\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols3"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{75\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols4"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{97.5\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols5"}\NormalTok{)}

\NormalTok{results3}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kbl}\NormalTok{(}\AttributeTok{caption =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Table 1. Posterior Quantiles of Lower Columbia Coho Escapement, "}\NormalTok{,f\_year),}\AttributeTok{digits =}\DecValTok{0}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_classic}\NormalTok{(}\AttributeTok{full\_width =}\NormalTok{ F, }\AttributeTok{html\_font =} \StringTok{"Cambria"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:fitmodels}Table 1. Posterior Quantiles of Lower Columbia Coho Escapement, 2021}
\centering
\begin{tabular}[t]{r|l|r|r|r|r|r}
\hline
Year & Group & 2.5\% & 25\% & 50\% & 75\% & 97.5\%\\
\hline
2021 & Wild Coho & 24409 & 39430 & 48903 & 62138 & 101452\\
\hline
2021 & Total Coho & 50545 & 72030 & 85480 & 102284 & 150896\\
\hline
\end{tabular}
\end{table}

\hypertarget{fit-and-results-version-2}{%
\subsection{Fit and Results Version 2}\label{fit-and-results-version-2}}

This version predicts final escapement using a state space log-normal
multivariate random walk with trend model; the same model used in the
Washington State ``State of the Salmon'' report (see code
\href{https://github.com/tbuehrens/WDFW_SOS_Analysis}{here}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat2}\OtherTok{\textless{}{-}}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"final data/cohocorr.csv"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(LCR.total)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(LCR.wild)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(Bonneville.total)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(Willamette.total)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{!}\NormalTok{Year,}\AttributeTok{names\_to =} \StringTok{"Population"}\NormalTok{,}\AttributeTok{values\_to =} \StringTok{"Abundance"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(Abundance))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{popnum =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.factor}\NormalTok{(Population)),}
         \AttributeTok{yearnum =}\NormalTok{ Year}\SpecialCharTok{{-}}\FunctionTok{min}\NormalTok{(Year)}\SpecialCharTok{+}\DecValTok{1}
\NormalTok{         )}


\NormalTok{standat}\OtherTok{\textless{}{-}}\FunctionTok{list}\NormalTok{(}
  \AttributeTok{run\_estimation =} \DecValTok{1}\NormalTok{,}
  \AttributeTok{T =} \FunctionTok{max}\NormalTok{(dat2}\SpecialCharTok{$}\NormalTok{Year,}\AttributeTok{na.rm =}\NormalTok{ T)}\SpecialCharTok{{-}}\FunctionTok{min}\NormalTok{(dat2}\SpecialCharTok{$}\NormalTok{Year,}\AttributeTok{na.rm =}\NormalTok{ T)}\SpecialCharTok{+}\DecValTok{1}\NormalTok{,}
  \AttributeTok{T\_forward =} \DecValTok{0}\NormalTok{,}
  \AttributeTok{T\_backward =} \DecValTok{0}\NormalTok{,}
  \AttributeTok{P =} \FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(dat2}\SpecialCharTok{$}\NormalTok{Population)),}
  \AttributeTok{n =} \FunctionTok{dim}\NormalTok{(dat2)[}\DecValTok{1}\NormalTok{],}
  \AttributeTok{N\_obs =}\NormalTok{ dat2}\SpecialCharTok{$}\NormalTok{Abundance,}
  \AttributeTok{pop\_obs =}\NormalTok{ dat2}\SpecialCharTok{$}\NormalTok{popnum,}
  \AttributeTok{year\_obs =}\NormalTok{ dat2}\SpecialCharTok{$}\NormalTok{yearnum,}
  \AttributeTok{N\_0\_med\_prior =}\NormalTok{ dat2}\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(Population)}\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(Year }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(Year))}\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ungroup}\NormalTok{()}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Abundance)}\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{unlist}\NormalTok{()}
\NormalTok{)}

\ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(}\StringTok{"results/prelim/m3.RDS"}\NormalTok{))\{}
\NormalTok{ model}\OtherTok{\textless{}{-}}\FunctionTok{stan\_model}\NormalTok{(}\AttributeTok{model\_code =} \FunctionTok{noquote}\NormalTok{(}\FunctionTok{readLines}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/tbuehrens/WDFW\_SOS\_Analysis/main/models/model\_mv\_v3.stan"}\NormalTok{)))}
\NormalTok{ fit}\OtherTok{\textless{}{-}}\FunctionTok{sampling}\NormalTok{(}\AttributeTok{object =}\NormalTok{ model,}
              \AttributeTok{data =}\NormalTok{ standat,}
              \AttributeTok{chains =} \DecValTok{4}\NormalTok{,}
              \AttributeTok{cores =} \DecValTok{4}\NormalTok{,}
              \AttributeTok{warmup =} \DecValTok{1000}\NormalTok{,}
              \AttributeTok{iter =} \DecValTok{2000}\NormalTok{,}
              \AttributeTok{thin =} \DecValTok{1}\NormalTok{,}
              \AttributeTok{control=} \FunctionTok{list}\NormalTok{(}\AttributeTok{adapt\_delta =} \FloatTok{0.99}\NormalTok{)}
\NormalTok{              )}
 \FunctionTok{saveRDS}\NormalTok{(fit,}\StringTok{"results/prelim/m3.RDS"}\NormalTok{)}
\NormalTok{\}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{  fit}\OtherTok{\textless{}{-}}\FunctionTok{readRDS}\NormalTok{(}\StringTok{"results/prelim/m3.RDS"}\NormalTok{)}
\NormalTok{\}}
\NormalTok{results4}\OtherTok{\textless{}{-}}\FunctionTok{melt}\NormalTok{(}\FunctionTok{extract}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{N)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{yearnum=}\NormalTok{Var2,}\AttributeTok{popnum=}\NormalTok{Var3,}\AttributeTok{Abundance\_fit=}\NormalTok{value)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(yearnum,popnum)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{Abundance\_fit =} \FunctionTok{quantile}\NormalTok{(Abundance\_fit, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{,}\FloatTok{0.975}\NormalTok{)), }\AttributeTok{q =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{,}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.75}\NormalTok{,}\FloatTok{0.975}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{id\_cols=}\FunctionTok{c}\NormalTok{(yearnum,popnum), }\AttributeTok{names\_from=}\NormalTok{q, }\AttributeTok{values\_from=}\NormalTok{Abundance\_fit)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(dat2}\SpecialCharTok{\%\textgreater{}\%}
              \FunctionTok{group\_by}\NormalTok{(popnum)}\SpecialCharTok{\%\textgreater{}\%}
              \FunctionTok{summarise}\NormalTok{(}\AttributeTok{Population=}\FunctionTok{first}\NormalTok{(Population))}
\NormalTok{            )}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(dat2}\SpecialCharTok{\%\textgreater{}\%}
              \FunctionTok{group\_by}\NormalTok{(yearnum)}\SpecialCharTok{\%\textgreater{}\%}
              \FunctionTok{summarise}\NormalTok{(}\AttributeTok{Year=}\FunctionTok{first}\NormalTok{(Year))}
\NormalTok{            )}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(dat2}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Year,Population,Abundance)}
\NormalTok{            )}

\NormalTok{p4}\OtherTok{\textless{}{-}}\FunctionTok{ggplot}\NormalTok{(results4}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Population}\SpecialCharTok{==}\StringTok{"LCR.wild"}\NormalTok{),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{Abundance))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{,}\ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"LCR.wild"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\StringTok{\textasciigrave{}}\AttributeTok{0.025}\StringTok{\textasciigrave{}}\NormalTok{,}\AttributeTok{ymax=}\StringTok{\textasciigrave{}}\AttributeTok{0.975}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\StringTok{\textasciigrave{}}\AttributeTok{0.25}\StringTok{\textasciigrave{}}\NormalTok{,}\AttributeTok{ymax=}\StringTok{\textasciigrave{}}\AttributeTok{0.75}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\StringTok{\textasciigrave{}}\AttributeTok{0.5}\StringTok{\textasciigrave{}}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data=}\NormalTok{results4}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year, Population }\SpecialCharTok{==}\StringTok{"LCR.wild"}\NormalTok{),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\StringTok{\textasciigrave{}}\AttributeTok{0.5}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{color=}\StringTok{"forestgreen"}\NormalTok{,}\AttributeTok{size=}\DecValTok{3}\NormalTok{)}

\NormalTok{p5}\OtherTok{\textless{}{-}}\FunctionTok{ggplot}\NormalTok{(results4}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Population}\SpecialCharTok{==}\StringTok{"LCR.total"}\NormalTok{),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\NormalTok{Abundance))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{,}\ConstantTok{NA}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"LCR.total"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\StringTok{\textasciigrave{}}\AttributeTok{0.025}\StringTok{\textasciigrave{}}\NormalTok{,}\AttributeTok{ymax=}\StringTok{\textasciigrave{}}\AttributeTok{0.975}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin=}\StringTok{\textasciigrave{}}\AttributeTok{0.25}\StringTok{\textasciigrave{}}\NormalTok{,}\AttributeTok{ymax=}\StringTok{\textasciigrave{}}\AttributeTok{0.75}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\StringTok{\textasciigrave{}}\AttributeTok{0.5}\StringTok{\textasciigrave{}}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data=}\NormalTok{results4}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year, Population }\SpecialCharTok{==}\StringTok{"LCR.total"}\NormalTok{),}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Year,}\AttributeTok{y=}\StringTok{\textasciigrave{}}\AttributeTok{0.5}\StringTok{\textasciigrave{}}\NormalTok{),}\AttributeTok{color=}\StringTok{"forestgreen"}\NormalTok{,}\AttributeTok{size=}\DecValTok{3}\NormalTok{)}


\NormalTok{p6}\OtherTok{\textless{}{-}}\FunctionTok{grid.arrange}\NormalTok{(p4, p5, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{preliminary_escapement_files/figure-latex/fitmodels2-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(p6)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## TableGrob (1 x 2) "arrange": 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results4}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(Year}\SpecialCharTok{==}\NormalTok{f\_year,Population }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"LCR.wild"}\NormalTok{,}\StringTok{"LCR.total"}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Year, Population,}\AttributeTok{cols=}\FunctionTok{contains}\NormalTok{(}\StringTok{"."}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{2.5\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols1"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{25\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols2"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{50\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols3"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{75\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols4"}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{97.5\%}\StringTok{\textasciigrave{}}\OtherTok{=}\StringTok{"cols5"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kbl}\NormalTok{(}\AttributeTok{caption =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Table 2. Posterior Quantiles of Lower Columbia Coho Escapement, "}\NormalTok{,f\_year),}\AttributeTok{digits =}\DecValTok{0}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_classic}\NormalTok{(}\AttributeTok{full\_width =}\NormalTok{ F, }\AttributeTok{html\_font =} \StringTok{"Cambria"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:fitmodels2}Table 2. Posterior Quantiles of Lower Columbia Coho Escapement, 2021}
\centering
\begin{tabular}[t]{r|l|r|r|r|r|r}
\hline
Year & Population & 2.5\% & 25\% & 50\% & 75\% & 97.5\%\\
\hline
2021 & LCR.total & 36057 & 75061 & 98086 & 128688 & 227857\\
\hline
2021 & LCR.wild & 21788 & 43828 & 58031 & 77507 & 141366\\
\hline
\end{tabular}
\end{table}

\end{document}
